<html>
    <head>
        <title>first test form</title>
        <link type="text/css" rel="stylesheet" href="ext-3.2.1/resources/css/ext-all.css"/>
        <link type="text/css" rel="stylesheet" href="ext-3.2.1/resources/css/xtheme-blue.css"/>
        <!-- extension library styles -->
        <link type="text/css" rel="stylesheet" href="ext-3.2.1/ux/css/MultiSelect.css"/>
        
        <script src="ext-3.2.1/adapter/ext/ext-base.js" type="text/javascript"></script>
        <script src="ext-3.2.1/ext-all.js" type="text/javascript"></script>
        <!-- extensions libraries -->
        <script src="ext-3.2.1/ux/MultiSelect.js" type="text/javascript"></script>
        
        
        <script language="javascript">
        Ext.onReady(function() {
            
            var dewarstore = new Ext.data.XmlStore({
                id: 'Dewar',
                url: 'get-dewar-info.php?group=2',
                record: 'row',
                fields: [ 'Dewar']
            });
            dewarstore.load();
            
            var stackstore = new Ext.data.XmlStore({
                url: 'get-dewar-info.php?group=2',
                record: 'row',
                fields: [ 'Dewar', 'Stack']
            });
            stackstore.load();
            
            var boxstore = new Ext.data.XmlStore({
                url: 'get-dewar-info.php?group=2',
                record: 'row',
                fields: [ 'Dewar', 'Stack', 'Box']
            });
            //boxstore.load();
            
            var positionstore = new Ext.data.XmlStore({
                url: 'get-dewar-info.php?group=2',
                record: 'row',
                fields: [ 'Dewar', 'Stack', 'Box', 'Position']
            });
            //positionstore.load();
            
            
            var simple = new Ext.FormPanel({
                labelWidth: 75, // label settings here cascade unless overridden
                frame:true,
                title: 'Select Location',
                bodyStyle:'padding:5px 5px 0',
                width: 350,
                defaults: {width: 230},
                defaultType: 'textfield',
                
                items: [
                        new Ext.form.ComboBox({
                            id: 'dewar',
                            fieldLabel: 'Dewar',
                            triggerAction: 'all',
                            mode: 'remote',
                            valueField: 'Dewar',
                            displayField: 'Dewar',
                            disableKeyFilter: true,
                            forceSelection: true,
                            editable: false,
                            store: dewarstore,
                            listeners: {
                                select: {
                                    fn: function(combo, value) {
                                        var stack = Ext.getCmp('stack');
                                        var box = Ext.getCmp('box');
                                        stack.clearValue();
                                        box.clearValue();
                                        stack.store.filter('Dewar', combo.getValue());
                                        //stack.store.loadData(stack.store.collect('Stack'));
                                        stack.setDisabled(stack.store.getCount() == 0);
                                        box.setDisabled(true);
                                    }
                                }
                            }
                        }),
                        
                        new Ext.form.ComboBox({
                            id: 'stack',
                            fieldLabel: 'Stack',
                            triggerAction: 'all',
                            mode: 'remote',
                            valueField: 'Stack',
                            displayField: 'Stack',
                            disableKeyFilter: true,
                            forceSelection: true,
                            editable: false,
                            store: stackstore,
                            listeners: {
                                added: {
                                    fn: function(combo) {
                                        combo.setDisabled(true);
                                    }
                                },
                                select: {
                                    fn: function(combo, value) {
                                        var dewar = Ext.getCmp('dewar');
                                        var box = Ext.getCmp('box');
                                        box.clearValue();
                                        box.store.filter([
                                                            {
                                                                property: 'Dewar',
                                                                value: dewar.getValue()
                                                            },
                                                            {
                                                                property: 'Stack',
                                                                value: combo.getValue()
                                                            }
                                        ]);
                                        box.setDisabled(box.store.getCount() == 0);
                                    }
                                }
                            }
                        }),
                        
                        new Ext.form.ComboBox({
                            id: 'box',
                            fieldLabel: 'Box',
                            triggerAction: 'all',
                            mode: 'remote',
                            valueField: 'Box',
                            displayField: 'Box',
                            disableKeyFilter: true,
                            forceSelection: true,
                            editable: false,
                            store: boxstore
                            
                        }),
                                           
                        
                        new Ext.ux.Multiselect({
                            id: 'position',
                            fieldLabel: 'Position',
                            name: 'multiselect',
                            width: 250,
                            height: 200,
                            allowBlank:false,
                            valueField: 'Position',
                            displayField: 'Position',
                            store: positionstore
                        })
                
                    ]
                       
            });
                      
           
            simple.render(document.getElementById('form'));
        });
        </script>
    </head>
    <body>
        <div id="form"></div>
    </body>
</html>